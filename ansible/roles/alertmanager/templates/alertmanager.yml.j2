global:
  # The smarthost and SMTP sender used for mail notifications.
  smtp_smarthost: 'prometheus:25'
  smtp_from: 'alertmanager@nedorezov.org'
  smtp_require_tls: false


# The root route on which each incoming alert enters.
route:
  # The root route must not have any matchers as it is the entry point for
  # all alerts. It needs to have a receiver configured so alerts that do not
  # match any of the sub-routes are sent to someone.
  receiver: 'nedorezov'

  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m

  repeat_interval: 3h

  routes:
  # This routes performs a regular expression match on alert labels to
  # catch alerts that are related to a list of services.
  - match_re:
      service: ^(web|netology)$
    receiver: nedorezov


# Inhibition rules allow to mute a set of alerts given that another alert is
# firing.
# We use this to mute any warning-level notifications if the same alert is
# already critical.
inhibit_rules:
- source_matchers:
    - severity="critical"
  target_matchers:
    - severity="warning"
  # Apply inhibition if the alertname is the same.
  # CAUTION:
  #   If all label names listed in `equal` are missing
  #   from both the source and target alerts,
  #   the inhibition rule will apply!
  equal: ['alertname']


receivers:

- name: 'nedorezov-telegram'
  telegram_configs:
  - bot_token: {{ telegram_bot_token }}
    api_url: https://api.telegram.org
    chat_id: {{ telegram_chat_id }}
    parse_mode: ''